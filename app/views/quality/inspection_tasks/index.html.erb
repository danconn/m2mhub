<% title 'Inspection Tasks' %>
<%= render 'quality/submenu' %>
<br />

<%= semantic_form_for @search, :as => :search, :url => inspection_tasks_url, :html => {:method => :get} do |f| %>
<table class="flatform">
	<tbody>
		<tr>
			<td>
				<%= f.inputs do %>
					<%= f.input :status, :collection => Quality::InspectionTaskStatus.all, :prompt => 'All', :wrapper_html => { :class => 'opportunity_search_status' } %>
					<%= f.input :task_type, :collection => Quality::InspectionTaskType.all, :prompt => 'All', :wrapper_html => { :class => 'opportunity_search_status' } %>
				<% end %>
			</td>
		</tr>
		<tr>
			<td>
				<%= f.buttons do %>
				  <%= f.commit_button 'Search' %>
					<% if permitted_to? :manage, :quality_inspection_tasks %>
					<li><%= link_to 'New Inspection Task', new_inspection_task_path %></li>
					<% end %>
				<% end %>
			</td>
		</tr>
	</tbody>
</table>
<% end %>

<%= set_focus('#search_status') %>

<% if @tasks.size == 0 %>
<p>There are no tasks, yet.  Create one!</p>
<% else %>
<%= will_paginate @tasks %>
<table class="data">
	<thead>
		<tr>
			<th>Created</th>
			<th>Title</th>
			<th>Type</th>
			<th>Customer / Due Date</th>
			<th>Status</th>
			<th>Ticket Status</th>
			<th>Assigned</th>
			<th>Modified</th>
		</tr>
	</thead>
	<tbody>
		<% @tasks.each do |t| %>
		<tr>
			<td><%= t.created_at.to_s(:short_human_date) %></td>
			<td><%= link_to t.title, inspection_task_url(t) %></td>
			<td>
				<% if t.task_type.rma_inspection? %>
				RMA <%= t.rma_number %>
				<% else %>
				PO <%= t.purchase_order_number %>
				<% end %>
			</td>
			<td>
				<% if t.task_type.rma_inspection? %>
				<%= t.rma_customer_name %>
				<% else %>
				<%= t.date_expected.try(:to_s, :short_human_date) %>
				<% end %>
			</td>
			<td><%= t.status %></td>
			<td><%= t.lighthouse_status %></td>
			<td><%= t.lighthouse_last_assigned_user_name %></td>
			<td><%= t.updated_at.to_s(:short_human_date) %></td>
		</tr>
		<% end %>
	</tbody>
</table>			
<% end %>

<% if @inspection_items %>
<h3>Parts In Inspection</h3>
<%= render 'production/inspection_items/list' %>
<% end %>

