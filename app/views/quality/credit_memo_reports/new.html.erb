<% include_closed_details_javascript %>
<%= render 'quality/submenu' %>
<br />

<% semantic_form_for :search, @search, :url => new_credit_memo_report_url, :html => {:method => :get} do |f| %>
<table class="flatform">
	<tbody>
		<tr>
			<td>
				<% f.inputs do %>
				  <%= f.input :year, :as => :select, :collection => year_options, :label => 'Year', :include_blank => false %>
				<% end %>
			</td>
			<td>
				<% f.buttons do %>
				  <%= f.commit_button 'View' %>
				<% end %>
			</td>
		</tr>
	</tbody>
</table>
<% end %>


<table class="data fullsize">
	<thead>
		<tr>
			<th>Date</th>
			<th>Month Total</th>
			<th>Quality Credit Memos</th>
			<th>Percent Quality Returns</th>
			<th>Details</th>
		</tr>
	</thead>
	<tbody>
	<% count = 0 %>
	<% @report.ordered_months.each do |month| %>
		<% count += 1 %>
		<tr>
			<td><%= month.date.to_s(:month_year) %></td>
			<td class="right">$<%= cm month.invoice_total, :quality_credit_memo_quantity, 0 %></td>
			<td class="right">$<%= cm month.quality_credit_memo_total, :quality_credit_memo_quantity, 0 %></td>
			<td class="right"><%= cm month.percent_quality_credit_memos, :quality_credit_memo_percentage, 0 %>%</td>
			<td class="rma_details">
				<% if month.credit_memos.size > 0 %>
				<a href="#"><span class="show_closed_details" id="closed_details_<%= count %>">Show Details</span></a>
				<div class="closed_details" id="xclosed_details_<%= count %>">
				<%= render 'credit_memo_details', :credit_memos => month.credit_memos %>
				</div>
				<% end %>
			</td>
		</tr>
	<% end %>
		<tr>
			<th>Totals</th>
			<th class="right">$<%= cm @report.invoice_total, :quality_credit_memo_quantity %></th>
			<th class="right">$<%= cm @report.quality_credit_memo_total, :quality_credit_memo_quantity %></th>
			<td class="right"><%= cm @report.percent_quality_credit_memos, :quality_credit_memo_percentage, 0 %>%</td>
			<td>
		</tr>
	</tbody>
</table>