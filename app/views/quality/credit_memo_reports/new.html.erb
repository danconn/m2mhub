<% include_closed_details_javascript %>
<%= render 'quality/submenu' %>
<br />

<%= render 'quality/year_search', :search_url => new_credit_memo_report_url %>

<table class="data fullsize">
	<thead>
		<tr>
			<th>Date</th>
			<th>Month Total</th>
			<th>Quality Credit Memos</th>
			<th>Percent Quality Returns</th>
			<th>Details</th>
		</tr>
	</thead>
	<tbody>
	<% @id_count ||= 0 %>
	<% @report.ordered_months.each do |month| %>
		<% @id_count += 1 %>
		<tr>
			<td><%= month.date.to_s(:month_year) %></td>
			<td class="right">$<%= cm month.invoice_total, :quality_credit_memo_quantity, 0 %></td>
			<td class="right">$<%= cm month.quality_credit_memo_total, :quality_credit_memo_quantity, 0 %></td>
			<td class="right"><%= cm month.percent_quality_credit_memos, :quality_credit_memo_percentage, 0 %>%</td>
			<td class="rma_details">
				<% if month.rma_items.size > 0 %>
				<a href="#"><span class="show_closed_details" id="closed_details_<%= @id_count %>">Show Details</span></a>
				<div class="closed_details" id="xclosed_details_<%= @id_count %>">
				<%= render 'credit_memo_details', :rma_items => month.rma_items %>
				</div>
				<% end %>
			</td>
		</tr>
	<% end %>
		<tr>
			<th>Totals</th>
			<th class="right">$<%= cm @report.invoice_total, :quality_credit_memo_quantity %></th>
			<th class="right">$<%= cm @report.quality_credit_memo_total, :quality_credit_memo_quantity %></th>
			<th class="right"><%= cm @report.percent_quality_credit_memos, :quality_credit_memo_percentage, 0 %>%</th>
		</tr>
	</tbody>
</table>

<%= render 'credit_memos_by_vendor' %>