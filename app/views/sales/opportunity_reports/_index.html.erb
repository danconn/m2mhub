<% include_toggle_javascript('report_details', image_tag(AppConfig.arrow_collapse_image),image_tag(AppConfig.arrow_expand_image)) %>

<table class="data">
	<thead>
		<tr>
			<th></th>
			<% @opportunity_report.months.each do |month| %>
				<th><%= month.to_s(:month_year) %></th>
			<% end %>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td></td>
			<% @opportunity_report.month_report.opportunity_buckets.each do |opportunity_bucket| %>
				<td>
					<%= opportunity_bucket.total_quoted_opportunities %>
					<%= cm opportunity_bucket.total_value, :rounded_dollars %>
				</td>
			<% end %>
		</tr>			
		<% @opportunity_report.territory_reports.each do |territory_report| %>
		<tr>
			<td><%= territory_report.name %></td>
			<% territory_report.opportunity_buckets.each do |opportunity_bucket| %>
				<td>
					<% if opportunity_bucket.total_quoted_opportunities > 0 %>
						<%= cm opportunity_bucket.total_quoted_opportunities %>
						<%= cm opportunity_bucket.total_value, :rounded_dollars %>
					<% end %>
				</td>
			<% end %>
		</tr>
		<% end %>
		<% if @opportunity_report.homeless_report.has_opportunities? %>
		<tr>
			<td>
				<a href="#homeless" class="report_details" id="report_details_homeless">
					<span class="replace_report_details_homeless"><%= image_tag(AppConfig.arrow_collapse_image) %></span>
					Homeless
				</a>
			</td>
			<% @opportunity_report.homeless_report.opportunity_buckets.each do |opportunity_bucket| %>
				<td>
					<% if opportunity_bucket.total_quoted_opportunities > 0 %>
						<%= cm opportunity_bucket.total_quoted_opportunities %>
						<%= cm opportunity_bucket.total_value, :rounded_dollars %>
					<% end %>
				</td>
			<% end %>
		</tr>
		<tr class="hide" id="xreport_details_homeless">
			<td colspan="<%= @opportunity_report.territory_reports.size + 1 %>">
				<ul>
					<% @opportunity_report.homeless_report.opportunities.each do |opportunity| %>
						<li><%= link_to opportunity.number_and_title, opportunity_url(opportunity) %></li>
					<% end %>
				</ul>
			</td>
		</tr>
		<% end %>
		
		<tr class="opportunity_spacer">
			<td colspan="<%= @opportunity_report.territory_reports.size + 1 %>">
			</td>
		</tr>
		
		<% @opportunity_report.owner_reports.each do |owner_report| %>
		<tr>
			<td><%= owner_report.name %></td>
			<% owner_report.opportunity_buckets.each do |opportunity_bucket| %>
				<td>
					<% if opportunity_bucket.total_quoted_opportunities > 0 %>
						<%= cm opportunity_bucket.total_quoted_opportunities %>
						<%= cm opportunity_bucket.total_value, :rounded_dollars %>
					<% end %>
				</td>
			<% end %>
		</tr>
		<% end %>
		<% if @opportunity_report.ownerless_report.has_opportunities? %>
		<tr>
			<td>
				<a href="#ownerless" class="report_details" id="report_details_ownerless">
					<span class="replace_report_details_ownerless"><%= image_tag(AppConfig.arrow_collapse_image) %></span>
					Ownerless
				</a>
			</td>
			<% @opportunity_report.ownerless_report.opportunity_buckets.each do |opportunity_bucket| %>
				<td>
					<% if opportunity_bucket.total_quoted_opportunities > 0 %>
						<%= cm opportunity_bucket.total_quoted_opportunities %>
						<%= cm opportunity_bucket.total_value, :rounded_dollars %>
					<% end %>
				</td>
			<% end %>
		</tr>
		<tr class="hide" id="xreport_details_ownerless">
			<td colspan="<%= @opportunity_report.territory_reports.size + 1 %>">
				<ul>
					<% @opportunity_report.ownerless_report.opportunities.each do |opportunity| %>
						<li><%= link_to opportunity.number_and_title, opportunity_url(opportunity) %></li>
					<% end %>
				</ul>
			</td>
		</tr>
		<% end %>
	</tbody>
</table>