<% content_for :javascripts do %>
<script type="text/javascript">
$(function() {
	$(".show_closed_details").toggle(function() { 
	  $("#x" + $(this).attr("id")).show();
	  $(this).html("Hide Details");
	}, function() {
	  $("#x" + $(this).attr("id")).hide();
	  $(this).html("Show Details");
	});
});
</script>
<% end %>

<% count = 0 %>
<table class="report">
	<thead>
		<tr>
			<th>Date</th>
			<th>Percent Late</th>
			<th>Details</th>
		</tr>
	</thead>
	<tbody>
<% @report.ordered_months.each do |month| %>
	<% count += 1 %>
	<tr>
		<td><%= month.date.to_s(:month_year) %></td>
		<td><%= cm month.percent_late, :on_time_delivery_report %>% Late (<%= month.num_late_releases %> / <%= month.num_releases %>)</td>
		<td>
			<% if month.num_late_releases > 0 %>
			<a href="#"><span class="show_closed_details" id="closed_details_<%= count %>">Show Details</span></a>
			<table class="data closed_details" id="xclosed_details_<%= count %>">
				<thead>
					<tr>
						<th>SO</th>
						<th>Qty</th>
						<th>Days Late</th>
						<th>Due</th>
						<th>Shipped</th>
						<th>Customer</th>
						<th>Part</th>
					</tr>
				</thead>
				<tbody>
			<% month.late_releases.sort_by(&:due_date).each do |r| %>
					<tr>
						<td><%= link_to r.sales_order.order_number, sales_order_url(r.sales_order) %></td>
						<td><%= cm r.order_quantity, :sales_order_quantity %></td>
						<td><%= cm r.days_late %></td>
						<td><%= r.due_date.to_s(:shipper_date) %></td>
						<td><%= r.last_ship_date.to_s(:shipper_date) %></td>
						<td><%= link_to r.sales_order.customer_name, customer_url(r.sales_order.fcustno) %></td>
						<td><%= link_to r.item.item.part_number, item_url(r.item.item.part_number) %></td>
					</tr>
			<% end %>
				</tbody>
			</table>
			<% end %>
		</td>
	</tr>
<% end %>
</table>